<div class="container dashboard">
  <h1 class="section-title">{{ 'home.title' | translate }}</h1>

  <div class="stats-grid">
    <mat-card class="stat-card stat-card--primary">
      <mat-card-content>
        <div class="stat-icon-wrap">
          <mat-icon>people</mat-icon>
        </div>
        <div class="stat-body">
          <div class="stat-value">{{ totalPatients }}</div>
          <div class="stat-label">{{ 'home.totalPatients' | translate }}</div>
        </div>
      </mat-card-content>
    </mat-card>
    <mat-card class="stat-card stat-card--info">
      <mat-card-content>
        <div class="stat-icon-wrap">
          <mat-icon>stethoscope</mat-icon>
        </div>
        <div class="stat-body">
          <div class="stat-value">{{ totalDoctors }}</div>
          <div class="stat-label">{{ 'home.totalDoctors' | translate }}</div>
        </div>
      </mat-card-content>
    </mat-card>
    <mat-card class="stat-card stat-card--highlight">
      <mat-card-content>
        <div class="stat-icon-wrap">
          <mat-icon>today</mat-icon>
        </div>
        <div class="stat-body">
          <div class="stat-value">{{ visitsThisMonth }}</div>
          <div class="stat-label">{{ 'home.visitsThisMonth' | translate }}</div>
        </div>
      </mat-card-content>
    </mat-card>
    <mat-card class="stat-card stat-card--danger">
      <mat-card-content>
        <div class="stat-icon-wrap">
          <mat-icon>bar_chart</mat-icon>
        </div>
        <div class="stat-body">
          <div class="stat-value">{{ totalVisits }}</div>
          <div class="stat-label">{{ 'home.totalVisits' | translate }}</div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="quick-actions">
    <h2>{{ 'home.quickActions' | translate }}</h2>
    <div class="actions-row">
      <a routerLink="/patients/new" matButton="elevated" color="primary">
        <mat-icon>person_add</mat-icon>
        {{ 'home.newPatient' | translate }}
      </a>
      <a routerLink="/visits/new" matButton="elevated" color="accent">
        <mat-icon>calendar_today</mat-icon>
        {{ 'home.newVisit' | translate }}
      </a>
      <button matButton="elevated" class="btn-amber" (click)="triggerXlsxInput()" [disabled]="importing()">
        <mat-icon>upload_file</mat-icon>
        @if (importing()) {
          {{ 'home.importing' | translate }}
        } @else {
          {{ 'home.importXlsx' | translate }}
        }
      </button>
      <input
        #xlsxInput
        type="file"
        multiple
        accept=".xlsx"
        (change)="onXlsxSelected($event)"
        style="display: none"
      />
    </div>
  </div>

  @if (importMessage()) {
    <div class="import-message" [class.error]="importError()">
      {{ importMessage() }}
    </div>
  }

  <div class="recent-visits-section">
    <h2>{{ 'home.recentVisits' | translate }}</h2>
    @if (recentVisits.length > 0) {
      <table class="data-table data-table-card">
        <thead>
          <tr>
            <th>{{ 'visits.date' | translate }}</th>
            <th>{{ 'visits.patient' | translate }}</th>
            <th>{{ 'visits.doctor' | translate }}</th>
            <th>{{ 'visits.diagnosis' | translate }}</th>
            <th>{{ 'visits.treatment' | translate }}</th>
            <th>{{ 'visits.price' | translate }}</th>
          </tr>
        </thead>
        <tbody>
          @for (visit of recentVisits; track visit.id) {
            <tr>
              <td [attr.data-label]="'visits.date' | translate">{{ visit.date | localizedDate:'mediumDate' }}</td>
              <td [attr.data-label]="'visits.patient' | translate"><a [routerLink]="['/patients', visit.patientId]">{{ getPatientName(visit.patientId) }}</a></td>
              <td [attr.data-label]="'visits.doctor' | translate">{{ getDoctorName(visit.doctorId) }}</td>
              <td [attr.data-label]="'visits.diagnosis' | translate">{{ getDiagnosisName(visit.diagnosisId) }}</td>
              <td [attr.data-label]="'visits.treatment' | translate">{{ getTreatmentName(visit.treatmentId) }}</td>
              <td [attr.data-label]="'visits.price' | translate">{{ visit.price | currencyFormat }}</td>
            </tr>
          }
        </tbody>
      </table>
    } @else {
      <div class="empty-state">
        <p class="empty-state-text">{{ 'home.noRecentVisits' | translate }}</p>
      </div>
    }
  </div>
</div>
