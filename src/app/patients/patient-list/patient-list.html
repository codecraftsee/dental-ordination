<div class="container page">
  <div class="page-header">
    <h1 class="section-title">{{ 'patients.title' | translate }}</h1>
    <a routerLink="/patients/new" class="btn btn-primary">{{ 'patients.addNew' | translate }}</a>
  </div>

  <div class="search-bar">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>{{ 'patients.search' | translate }}</mat-label>
      <input matInput (input)="onSearch($event)" />
    </mat-form-field>
    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>{{ 'patients.filterCity' | translate }}</mat-label>
      <mat-select (selectionChange)="cityFilter.set($event.value)">
        <mat-option value="">{{ 'patients.filterCity' | translate }}</mat-option>
        @for (city of cities(); track city) {
          <mat-option [value]="city">{{ city }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>{{ 'patients.filterGender' | translate }}</mat-label>
      <mat-select (selectionChange)="genderFilter.set($event.value)">
        <mat-option value="">{{ 'patients.filterGender' | translate }}</mat-option>
        <mat-option value="male">{{ 'patient.gender.male' | translate }}</mat-option>
        <mat-option value="female">{{ 'patient.gender.female' | translate }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  @if (filteredPatients().length > 0) {
    <table class="data-table data-table-card">
      <thead>
        <tr>
          <th>{{ 'patients.name' | translate }}</th>
          <th>{{ 'patients.parentName' | translate }}</th>
          <th>{{ 'patients.dateOfBirth' | translate }}</th>
          <th>{{ 'patients.city' | translate }}</th>
          <th>{{ 'patients.phone' | translate }}</th>
          <th>{{ 'patients.actions' | translate }}</th>
        </tr>
      </thead>
      <tbody>
        @for (patient of filteredPatients(); track patient.id) {
          <tr>
            <td [attr.data-label]="'patients.name' | translate"><a [routerLink]="['/patients', patient.id]">{{ patient.firstName }} {{ patient.lastName }}</a></td>
            <td [attr.data-label]="'patients.parentName' | translate">{{ patient.parentName }}</td>
            <td [attr.data-label]="'patients.dateOfBirth' | translate">{{ patient.dateOfBirth | localizedDate:'mediumDate' }}</td>
            <td [attr.data-label]="'patients.city' | translate">{{ patient.city }}</td>
            <td [attr.data-label]="'patients.phone' | translate">{{ patient.phone }}</td>
            <td class="td-actions">
              <a [routerLink]="['/patients', patient.id]" class="btn btn-sm btn-outline">{{ 'common.view' | translate }}</a>
              <a [routerLink]="['/patients', patient.id, 'edit']" class="btn btn-sm btn-outline">{{ 'common.edit' | translate }}</a>
              <a [routerLink]="['/patients', patient.id, 'dental-card']" class="btn btn-sm btn-primary">{{ 'patients.viewDentalCard' | translate }}</a>
            </td>
          </tr>
        }
      </tbody>
    </table>
  } @else {
    <div class="empty-state">
      <p class="empty-state-text">{{ 'patients.noResults' | translate }}</p>
    </div>
  }
</div>
