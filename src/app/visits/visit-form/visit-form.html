<div class="container page">
  <div class="page-header">
    <h1 class="section-title">{{ 'visit.title.new' | translate }}</h1>
  </div>

  <div class="card">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">{{ 'visit.patient' | translate }}</label>
          <select class="form-control" formControlName="patientId">
            <option value="">{{ 'visit.selectPatient' | translate }}</option>
            @for (p of patients; track p.id) {
              <option [value]="p.id">{{ p.firstName }} {{ p.lastName }}</option>
            }
          </select>
          @if (f['patientId'].invalid && f['patientId'].touched) {
            <div class="form-error">{{ 'common.required' | translate }}</div>
          }
        </div>
        <div class="form-group">
          <label class="form-label">{{ 'visit.doctor' | translate }}</label>
          <select class="form-control" formControlName="doctorId">
            <option value="">{{ 'visit.selectDoctor' | translate }}</option>
            @for (d of doctors; track d.id) {
              <option [value]="d.id">Dr. {{ d.firstName }} {{ d.lastName }}</option>
            }
          </select>
          @if (f['doctorId'].invalid && f['doctorId'].touched) {
            <div class="form-error">{{ 'common.required' | translate }}</div>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">{{ 'visit.date' | translate }}</label>
          <input type="date" class="form-control" formControlName="date" />
          @if (f['date'].invalid && f['date'].touched) {
            <div class="form-error">{{ 'common.required' | translate }}</div>
          }
        </div>
        <div class="form-group">
          <label class="form-label">{{ 'visit.toothNumber' | translate }}</label>
          <input type="number" class="form-control" formControlName="toothNumber" min="1" max="48" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">{{ 'visit.diagnosis' | translate }}</label>
          <select class="form-control" formControlName="diagnosisId">
            <option value="">{{ 'visit.selectDiagnosis' | translate }}</option>
            @for (dg of diagnoses; track dg.id) {
              <option [value]="dg.id">{{ dg.code }} - {{ dg.name }}</option>
            }
          </select>
          @if (f['diagnosisId'].invalid && f['diagnosisId'].touched) {
            <div class="form-error">{{ 'common.required' | translate }}</div>
          }
        </div>
        <div class="form-group">
          <label class="form-label">{{ 'visit.diagnosisNotes' | translate }}</label>
          <input type="text" class="form-control" formControlName="diagnosisNotes" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">{{ 'visit.treatment' | translate }}</label>
          <select class="form-control" formControlName="treatmentId">
            <option value="">{{ 'visit.selectTreatment' | translate }}</option>
            @for (tx of treatments; track tx.id) {
              <option [value]="tx.id">{{ tx.code }} - {{ tx.name }}</option>
            }
          </select>
          @if (f['treatmentId'].invalid && f['treatmentId'].touched) {
            <div class="form-error">{{ 'common.required' | translate }}</div>
          }
        </div>
        <div class="form-group">
          <label class="form-label">{{ 'visit.treatmentNotes' | translate }}</label>
          <input type="text" class="form-control" formControlName="treatmentNotes" />
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">{{ 'visit.price' | translate }}</label>
        <input type="number" class="form-control" formControlName="price" min="0" />
        @if (f['price'].invalid && f['price'].touched) {
          <div class="form-error">{{ 'common.required' | translate }}</div>
        }
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">{{ 'common.save' | translate }}</button>
        <a routerLink="/visits" class="btn btn-outline">{{ 'common.cancel' | translate }}</a>
      </div>
    </form>
  </div>
</div>
